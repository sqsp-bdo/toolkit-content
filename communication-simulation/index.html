<html>
    <head>
        <link rel="stylesheet" href="/toolkit-content/livechat-simulation/css-5kb.css">
        <style>
            #content {
                width: 100%;
                height: 100%;
                font-family: sans-serif;
            }
        </style>
    </head>
    <link rel="icon" 
        type="image/png" 
        href="/toolkit-content/favicon.png" />
    <body>
        <div id="content">
            <input type="text" onkeydown="setTimeoutValue()" id="timeout"/>
            <div id="output"></div>
        </div>

        <script src="/toolkit-content/toolkit-client.js"></script>

        <script>

            function getParameterByName(name, url = window.location.href) {
                name = name.replace(/[\[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }

            var timeout = getParameterByName('timeout') ? Number(getParameterByName('timeout')) : 1000;

            function setTimeoutValue()
            {
                if(event.key !== 'Enter') {
                    return;      
                }

                timeout = document.getElementById('timeout').value;
            }

            document.getElementById('timeout').value = timeout;

            const toolkitClient = makeToolkitClient('https://mayflower-pike-jg7c.dev.squarespace.net');

            if (!!toolkitClient) {
                toolkitClient.subscribe((data) => { console.log(data) }, ['windowResize']);
                toolkitClient.getComponents().then(components => console.log(components));
                toolkitClient.setVisibility(true, '220px', '0px');

                function recursivelyGetComponents() {
                    toolkitClient.getComponents().then(components => {
                        console.log(components);
                        document.getElementById('output').value = 'Response received at ' + new Date();
                    });
                    toolkitClient.setVisibility(true, '220px', '0px');
                    setTimeout(timeout(), recursivelyGetComponents);
                }

                recursivelyGetComponents();
            }
        </script>
    </body>
</html>